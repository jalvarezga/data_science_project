<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Analysis Tool</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
    <style>
      /* Your CSS goes here, or import via styles.css */
    </style>
  </head>
  <body>
    <img
      src="{{ url_for('static', filename='marshall_logo.jpg') }}"
      alt="Marshall logo"
      id="logo"
    />
    <h1>Data Analysis Tool</h1>
    <form
      action="{{ url_for('main.reset') }}"
      method="get"
      style="display: inline"
    >
      <button
        type="submit"
        style="
          background-color: #dc3545;
          color: white;
          border: none;
          padding: 10px 15px;
          border-radius: 4px;
          cursor: pointer;
        "
      >
        Reset
      </button>
    </form>
    <!-- Tabs Section -->
    <div class="tab-container">
      <button
        class="tab-button {% if not success and not histogram_img %}active{% endif %}"
        onclick="setActiveTab('upload-section', 'upload-code')"
      >
        Upload CSV
      </button>

      {% if success %}
      <button
        class="tab-button {% if histogram_img %}active{% endif %}"
        onclick="setActiveTab('table-section', 'show-table-code')"
      >
        Show First Rows
      </button>
      {% if success and not no_numeric %}
      <button
        class="tab-button {% if summary_data %}active{% endif %}"
        onclick="setActiveTab('summary-section', 'summary-code')"
      >
        Summary
      </button>
      {% endif %}
      <button
        class="tab-button {% if histogram_img %}active{% endif %}"
        onclick="setActiveTab('histogram-section', 'histogram-code')"
      >
        Show Histogram
      </button>
      {% endif %} {% if success and not no_numeric %}
      <!-- Existing buttons -->
      <button
        class="tab-button {% if scatter_img %}active{% endif %}"
        onclick="setActiveTab('scatter-section', 'scatter-code')"
      >
        Scatter Plot
      </button>
      {% endif %}
    </div>

    <!-- Include Partials -->
    {% include "upload.html" %} {% include "show_rows.html" %}{% include
    'summary.html' %} {% include "histogram.html" %}{% include 'scatter.html' %}
    {% include "code_snippet.html" %}

    <!-- JavaScript -->
    <script>
      let activeCodeId = null;

      function setActiveTab(sectionId, codeId) {
        // Hide all content sections
        const contentSections = document.querySelectorAll(".content-section");
        contentSections.forEach((section) => section.classList.add("hidden"));

        // Show selected content section
        const selectedSection = document.getElementById(sectionId);
        if (selectedSection) {
          selectedSection.classList.remove("hidden");
        }

        // Update active tab button styling
        const tabButtons = document.querySelectorAll(".tab-button");
        tabButtons.forEach((button) => button.classList.remove("active"));

        const activeButton = Array.from(tabButtons).find((button) =>
          button.getAttribute("onclick").includes(`'${sectionId}'`)
        );
        if (activeButton) {
          activeButton.classList.add("active");
        }

        // Update the active code ID
        activeCodeId = codeId;

        // âœ… NEW BEHAVIOR: If code snippet is visible, just close it
        const codeSnippetContainer = document.getElementById(
          "code-snippet-container"
        );
        if (codeSnippetContainer.style.display === "block") {
          codeSnippetContainer.style.display = "none";
        }
      }

      function toggleCodeSnippet() {
        const codeSnippetContainer = document.getElementById(
          "code-snippet-container"
        );
        const codeElement = document.getElementById("code-snippet");
        const selectedCodeElement = document.getElementById(activeCodeId);

        codeSnippetContainer.style.display =
          codeSnippetContainer.style.display === "none" ? "block" : "none";

        if (
          codeSnippetContainer.style.display === "block" &&
          selectedCodeElement
        ) {
          codeElement.textContent = selectedCodeElement.textContent.trim();
        }
      }

      window.onload = function () {
        const defaultTab =
          "{{ current_tab if current_tab else 'upload-section' }}";
        const codeMap = {
          "upload-section": "upload-code",
          "table-section": "show-table-code",
          "histogram-section": "histogram-code",
          "scatter-section": "scatter-code",
          "summary-section": "summary-code",
        };
        setActiveTab(defaultTab, codeMap[defaultTab]);
      };
    </script>
  </body>
</html>
